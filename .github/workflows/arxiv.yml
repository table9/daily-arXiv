- uses: actions/setup-python@v5
  with:
    python-version: "3.10"
    cache: "pip"
    cache-dependency-path: requirements.txt

- name: Install Python deps
  run: |
    python -m pip install --upgrade pip
    if [ -f requirements.txt ]; then
      pip install -r requirements.txt
    else
      # 最小依赖集：确保有 scrapy（以及常见用到的库，避免后面再缺）
      pip install scrapy openai PyYAML Jinja2 pandas requests beautifulsoup4 lxml feedparser tqdm
    fi

- name: Print config (debug)
  run: |
    echo "CATEGORIES=${{ vars.CATEGORIES }}"
    echo "LANGUAGE=${{ vars.LANGUAGE }}"
    echo "MODEL_NAME=${{ vars.MODEL_NAME }}"

- name: Run crawler + summarizer
  env:
    OPENAI_API_KEY:  ${{ secrets.OPENAI_API_KEY }}
    OPENAI_BASE_URL: ${{ secrets.OPENAI_BASE_URL }}
    LANGUAGE:        ${{ vars.LANGUAGE }}
    CATEGORIES:      ${{ vars.CATEGORIES }}
    MODEL_NAME:      ${{ vars.MODEL_NAME }}
  run: |
    bash run.sh
